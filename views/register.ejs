<!DOCTYPE html>
<html lang="en">
    <%- include('./partials/head.ejs') %>
<body>
<form class="reg-form">
    <div class="container"> 

        <div class="login">
            <h1>Register</h1>
            <div class="user">
                <i class="fa fa-user" aria-hidden="true"></i>
                <label for="username" >Username</label><br>
                <input type="text" name="username">
                <div class="username error"></div>
            </div>
            <div class="pass">
                <i class="fa fa-lock" aria-hidden="true"></i>
                <label for="password">Password</label><br>
                <input type="password" name="password">
                <div class="password error"></div>
            </div>
            <button class='btn'>Sign Up</button>
        </div>    

    </div>
</form>

<script>
    const form = document.querySelector('.reg-form')
    const userError = document.querySelector('.username.error')
    const passwordError = document.querySelector('.password.error')

    form.addEventListener('submit', async (e) => {
        e.preventDefault()

        const username = form.username.value 
        const password = form.password.value

        userError.textContent = ''
        passwordError.textContent = ''

        try {
            const res = await fetch('/register', {
                method: 'POST',
                body: JSON.stringify({ username, password }),
                headers: { "Content-Type": "application/json" }
            })

            const data = await res.json()
            if (data.errors) {
                userError.textContent = data.errors.username
                passwordError.textContent = data.errors.password
            }
            if (data.user) {
                location.assign('/')
            }
            
        } catch (err) {
            console.log(err)
        }  
    })
</script>
</body>
</html>